Этот урок посвящается базовым командам для работы с образами

docker images

Наберите команду

```
docker images
```
и вы увидите все ранее вами склонированные вами образы
```
docker rmi
```
Данная команда нужна чтобы удалить образ. Если добавить флаг --force, то удаляться также все контейнеры относящиеся к этому образу. Наберите и увидите, что образ hello-world удалился

```
docker rmi hello-world
docker images
```

Важно! Вместо hello-world вы можете указать любой имеющийся у вас образ
```
docker pull
```
Это команда нужна чтобы склонировать образ себе локально. Например, загрузим образ Ubuntu

```
docker pull ubuntu
docker images
```

Сборка своего образа на основе контейнера

Собрать образ можно двумя способами:

1. На основе состояния контейнера

2. На основе другого образа через Dockerfile. Об этом мы поговорим в следующем уроке

Давайте соберем образ программы, которая будет складывать два переданных ей числа. Сборку будем производить на основе контейнера, созданного из образа OpenJDK.

Образ OpenJDK не содержит редактора кода, поэтому напишем сначала код локально, а потом файл перенесем в контейнер

1. Создаем файл

```
touch Program.java
```

2. Редактируем файл

1) Открываем редактор

```
nano Program.java
```
2) пишем содержимое

```
public class Program {
public static void main(String[] args) {
int a = Integer.valueOf(args[0]);
int b = Integer.valueOf(args[1]);
System.out.println("Sum: " + (a + b));
}
}
```

3) Выходим из редактора, набирая комбинацию. Сначала Ctrl + X, затем Y и наконец Enter

4) Проверяем, что изменения сохранились

```
cat Program.java
```

3. Запускаем контейнер в фоновом режиме. -d позволяет запустить контейнер в фоновом режиме, при этом в самом контейнере запускается терминал, за это отвечает ключ -it (-i + -t)

```
docker run -d -it opendjdk bash
```
Проверяем что контейнер работает

```
docker ps
```

docker ps <=> docker container ls

4. Переносим файл с исходным кодом в контейнер

```
docker cp Program.java id:/
```
Данная команда копирует файла Program.java в корень контейнера. id это id контейнера, у вас он будет свой!

5. Подключаемся к контейнеру и проверяем, что файл там появился

```
docker container attach id
```

6. Откомпилируем программу и запустим ее

```
javac Program.java
java Program
```

7. Выходим из контейнера, но так чтобы он не выключился, набирая комбинацию Ctrl + P + Q

8. Создаем образ с помощью команды commit

```
docker commit --change='ENTRYPOINT ["java", "Program"]' id local:job4j
```
id это id контейнера. local это имя образа и по совместительству репозиторий. job4j это тэг.

Важно! Мы создаем образ из текущего состояния контейнера, а это значит что в нашем образе сохраняться файлы Program.java и Program.class. Последний и будет запускаться с помощью команды java

Флаг --change вписывает инструкцию Dockerfile. На данном этапе важно понимать, что при запуске контейнера запускается определенная программа. Запуск этой программы прописывается через ENTRYPOINT (если явно не указано, что запускать). В нем мы прописываем как запускать программу. ENTRYPOINT ["java", "Program"] эквивалентно тому, если бы набрали в терминале java Program



Видим что создался образ



9. Теперь мы можем уже запустить свой образ

```
docker run --rm local:job4j 1 2
```
1 и 2 это аргументы передаваемые в нашу программу